<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School News Editor & Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .auth-section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .auth-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .main-content {
            display: none;
        }

        .management-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 25px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .news-form {
            display: grid;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .news-list {
            display: grid;
            gap: 20px;
        }

        .news-item-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #667eea;
        }

        .news-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .news-item-card.urgent {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff 0%, #ffe6e6 100%);
        }

        .news-item-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .news-item-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            flex: 1;
        }

        .news-item-date {
            color: #666;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .news-item-category {
            display: inline-block;
            padding: 4px 12px;
            background: #667eea;
            color: white;
            border-radius: 15px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .news-item-content {
            margin-bottom: 15px;
            line-height: 1.6;
            color: #555;
        }

        .news-item-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading-indicator i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .close {
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .search-box {
            position: relative;
            flex: 1;
            max-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
        }

        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .urgent-indicator {
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-newspaper"></i> School News Manager</h1>
            <p>Create, edit, and manage school news articles</p>
        </div>

        <!-- GitHub Authentication -->
        <div class="auth-section">
            <h2><i class="fas fa-key"></i> GitHub Authentication</h2>
            <div class="form-group">
                <label for="githubToken">GitHub Personal Access Token:</label>
                <input type="password" id="githubToken" class="form-control" 
                       placeholder="Enter your GitHub token with Contents & Metadata permissions">
            </div>
            <button onclick="authenticateGitHub()" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i> Connect to GitHub
            </button>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-indicator">
            <i class="fas fa-spinner"></i>
            <p>Processing...</p>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content">
            <!-- Management Tabs -->
            <div class="management-tabs">
                <button class="tab-btn active" onclick="switchTab('add')">
                    <i class="fas fa-plus"></i> Add News
                </button>
                <button class="tab-btn" onclick="switchTab('manage')">
                    <i class="fas fa-list"></i> Manage News
                </button>
                <button class="tab-btn" onclick="switchTab('stats')">
                    <i class="fas fa-chart-bar"></i> Statistics
                </button>
            </div>

            <!-- Add News Tab -->
            <div class="tab-content" id="addTab">
                <div class="tab-pane active">
                    <h2><i class="fas fa-plus-circle"></i> Add New Article</h2>
                    <form id="newsForm" class="news-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newsTitle">Title *</label>
                                <input type="text" id="newsTitle" class="form-control" required 
                                       placeholder="Enter news title">
                            </div>
                            <div class="form-group">
                                <label for="newsCategory">Category *</label>
                                <select id="newsCategory" class="form-control" required>
                                    <option value="">Select Category</option>
                                    <option value="urgent">Urgent</option>
                                    <option value="academic">Academic</option>
                                    <option value="events">Events</option>
                                    <option value="announcements">Announcements</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="newsContent">Content *</label>
                            <textarea id="newsContent" class="form-control" required rows="6" 
                                      placeholder="Enter the news content (you can add multiple paragraphs)"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newsTags">Tags (comma-separated)</label>
                                <input type="text" id="newsTags" class="form-control" 
                                       placeholder="e.g., Important, Schedule, Competition">
                            </div>
                            <div class="form-group">
                                <label for="newsDate">Publication Date</label>
                                <input type="date" id="newsDate" class="form-control">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="isUrgent"> Mark as Urgent
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add News Article
                        </button>
                    </form>
                </div>
            </div>

            <!-- Manage News Tab -->
            <div class="tab-content" id="manageTab" style="display: none;">
                <div class="tab-pane">
                    <h2><i class="fas fa-cog"></i> Manage News Articles</h2>
                    
                    <!-- Controls -->
                    <div class="controls">
                        <div class="filter-controls">
                            <select id="categoryFilter" class="form-control" onchange="filterNews()" style="width: auto;">
                                <option value="">All Categories</option>
                                <option value="urgent">Urgent</option>
                                <option value="academic">Academic</option>
                                <option value="events">Events</option>
                                <option value="announcements">Announcements</option>
                            </select>
                            
                            <div class="search-box">
                                <input type="text" id="searchBox" placeholder="Search news..." 
                                       oninput="searchNews()">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        
                        <div class="action-controls">
                            <button onclick="refreshNews()" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                            <button onclick="generateNewsHTML()" class="btn btn-success">
                                <i class="fas fa-download"></i> Export HTML
                            </button>
                        </div>
                    </div>
                    
                    <!-- News List -->
                    <div id="newsList" class="news-list">
                        <!-- News items will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div class="tab-content" id="statsTab" style="display: none;">
                <div class="tab-pane">
                    <h2><i class="fas fa-chart-line"></i> News Statistics</h2>
                    
                    <div class="stats-grid" id="statsGrid">
                        <!-- Statistics will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit News Article</h3>
                    <span class="close" onclick="closeEditModal()">&times;</span>
                </div>
                <form id="editForm">
                    <div class="form-group">
                        <label for="editTitle">Title *</label>
                        <input type="text" id="editTitle" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCategory">Category *</label>
                        <select id="editCategory" class="form-control" required>
                            <option value="urgent">Urgent</option>
                            <option value="academic">Academic</option>
                            <option value="events">Events</option>
                            <option value="announcements">Announcements</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editContent">Content *</label>
                        <textarea id="editContent" class="form-control" required rows="6"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTags">Tags (comma-separated)</label>
                        <input type="text" id="editTags" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="editIsUrgent"> Mark as Urgent
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" onclick="closeEditModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Article</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // GITHUB STORAGE CONFIGURATION
        // ============================================================================
        
        // Global variables
        let githubToken = '';
        let newsData = [];
        let currentEditIndex = -1;
        
        // GitHub configuration
        // üîß CONFIGURATION: Replace with your GitHub details
        const githubConfig = {
            owner: 'yashverma2628',     // ‚Üê Replace with your GitHub username
            repo: 'school-project',     // ‚Üê Replace with your repository name
            branch: 'main',             // ‚Üê Replace with your branch name if different
            dataFile: 'news-data.json' // ‚Üê JSON file to store news data
        };

        // ============================================================================
        // GITHUB AUTHENTICATION
        // ============================================================================

        function authenticateGitHub() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                showStatus('Please enter your GitHub Personal Access Token', 'error');
                return;
            }

            showLoading(true);
            githubToken = token;
            
            // Test the token by accessing the repository
            fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}`, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (response.ok) {
                    // Store token for convenience
                    localStorage.setItem('githubToken', token);
                    
                    showStatus('‚úÖ Successfully connected to GitHub repository!', 'success');
                    document.getElementById('mainContent').style.display = 'block';
                    loadNewsData();
                } else {
                    throw new Error('Invalid token or repository access denied. Check your token permissions.');
                }
            })
            .catch(error => {
                showStatus('‚ùå Authentication failed: ' + error.message, 'error');
                console.error('GitHub auth error:', error);
            })
            .finally(() => {
                showLoading(false);
            });
        }

        // ============================================================================
        // GITHUB DATA MANAGEMENT
        // ============================================================================

        async function loadNewsData() {
            try {
                showLoading(true);
                
                // Try to load news data from GitHub
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.dataFile}`, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const content = atob(data.content);
                    newsData = JSON.parse(content);
                } else {
                    // File doesn't exist, initialize with sample data
                    await initializeNewsData();
                }
                
                renderNews();
                renderStats();
                
            } catch (error) {
                console.error('Error loading news data:', error);
                // Initialize with sample data on error
                await initializeNewsData();
            } finally {
                showLoading(false);
            }
        }

        async function saveNewsData() {
            try {
                showLoading(true);
                
                const content = JSON.stringify(newsData, null, 2);
                const base64Content = btoa(content);
                
                // Check if file exists to get SHA
                let sha = null;
                try {
                    const checkResponse = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.dataFile}`, {
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (checkResponse.ok) {
                        const existingFile = await checkResponse.json();
                        sha = existingFile.sha;
                    }
                } catch (e) {
                    // File doesn't exist, which is fine
                }

                const uploadData = {
                    message: `Update news data - ${new Date().toISOString()}`,
                    content: base64Content,
                    branch: githubConfig.branch
                };

                if (sha) {
                    uploadData.sha = sha;
                }

                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.dataFile}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(uploadData)
                });

                if (!response.ok) {
                    throw new Error('Failed to save to GitHub');
                }
                
                showStatus('‚úÖ News data saved to GitHub successfully!', 'success');
                
            } catch (error) {
                showStatus('‚ùå Failed to save: ' + error.message, 'error');
                console.error('Save error:', error);
            } finally {
                showLoading(false);
            }
        }

        async function initializeNewsData() {
            // Initialize with sample news data matching your HTML structure
            newsData = [
                {
                    id: Date.now() + 1,
                    title: 'Winter Break Extended',
                    content: 'Due to ongoing construction work in the main building, winter break has been extended by one week. Classes will resume on June 15, 2025.\n\nAll students and parents are requested to take note of this change. The school administration apologizes for any inconvenience caused and appreciates your understanding.',
                    category: 'urgent',
                    tags: ['Important', 'Schedule'],
                    date: '2025-06-03',
                    isUrgent: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: Date.now() + 2,
                    title: 'Annual Sports Day 2025',
                    content: 'Our Annual Sports Day will be held on June 20, 2025, at the school grounds. This year\'s theme is "Unity in Diversity" celebrating our multicultural student body.\n\nRegistration forms are available at the school office. Parents are cordially invited to attend and cheer for their children. Various competitions and cultural programs are planned.',
                    category: 'events',
                    tags: ['Sports', 'Event', 'Competition'],
                    date: '2025-06-01',
                    isUrgent: false,
                    createdAt: new Date().toISOString()
                },
                {
                    id: Date.now() + 3,
                    title: 'New Science Laboratory Inauguration',
                    content: 'We are excited to announce the inauguration of our new state-of-the-art science laboratory equipped with modern instruments and safety equipment.\n\nThe facility will be open for students from Class 8 onwards starting next week. Special orientation sessions will be conducted for students and teachers.',
                    category: 'academic',
                    tags: ['Science', 'Laboratory', 'Facility'],
                    date: '2025-05-28',
                    isUrgent: false,
                    createdAt: new Date().toISOString()
                }
            ];
            
            await saveNewsData();
        }

        // ============================================================================
        // NEWS MANAGEMENT
        // ============================================================================

        // Add news form submission
        document.getElementById('newsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('newsTitle').value.trim();
            const content = document.getElementById('newsContent').value.trim();
            const category = document.getElementById('newsCategory').value;
            const tags = document.getElementById('newsTags').value.trim();
            const date = document.getElementById('newsDate').value || new Date().toISOString().split('T')[0];
            const isUrgent = document.getElementById('isUrgent').checked;

            if (!title || !content || !category) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }

            const newArticle = {
                id: Date.now(),
                title: title,
                content: content,
                category: category,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                date: date,
                isUrgent: isUrgent,
                createdAt: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            newsData.unshift(newArticle); // Add to beginning
            await saveNewsData();
            
            // Reset form
            document.getElementById('newsForm').reset();
            
            // Refresh displays
            renderNews();
            renderStats();
            
            showStatus('‚úÖ News article added successfully!', 'success');
        });

        // Edit form submission
        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (currentEditIndex === -1) return;

            const title = document.getElementById('editTitle').value.trim();
            const content = document.getElementById('editContent').value.trim();
            const category = document.getElementById('editCategory').value;
            const tags = document.getElementById('editTags').value.trim();
            const isUrgent = document.getElementById('editIsUrgent').checked;

            if (!title || !content || !category) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }

            // Update news data
            newsData[currentEditIndex].title = title;
            newsData[currentEditIndex].content = content;
            newsData[currentEditIndex].category = category;
            newsData[currentEditIndex].tags = tags ? tags.split(',').map(tag => tag.trim()) : [];
            newsData[currentEditIndex].isUrgent = isUrgent;
            newsData[currentEditIndex].lastModified = new Date().toISOString();

            await saveNewsData();
            renderNews();
            renderStats();
            closeEditModal();

            showStatus('‚úÖ News article updated successfully!', 'success');
        });

        // ============================================================================
        // UI FUNCTIONS
        // ============================================================================

        // Complete the switchTab function and add all remaining functionality
        
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            document.getElementById(tab + 'Tab').style.display = 'block';
            
            // Load specific tab data
            if (tab === 'manage') {
                renderNews();
            } else if (tab === 'stats') {
                renderStats();
            }
        }

        function renderNews() {
            const container = document.getElementById('newsList');
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();

            let filteredNews = newsData;
            
            // Apply category filter
            if (categoryFilter) {
                filteredNews = filteredNews.filter(news => news.category === categoryFilter);
            }
            
            // Apply search filter
            if (searchTerm) {
                filteredNews = filteredNews.filter(news => 
                    news.title.toLowerCase().includes(searchTerm) ||
                    news.content.toLowerCase().includes(searchTerm) ||
                    (news.tags && news.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                );
            }

            if (filteredNews.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>No news articles found</h3>
                        <p>Try adjusting your filters or add some news articles!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredNews.map((news, index) => `
                <div class="news-item-card ${news.isUrgent ? 'urgent' : ''}">
                    <div class="news-item-header">
                        <div class="news-item-title">
                            ${news.title}
                            ${news.isUrgent ? '<span class="urgent-indicator">URGENT</span>' : ''}
                        </div>
                        <div class="news-item-date">
                            <i class="fas fa-calendar"></i>
                            ${new Date(news.date).toLocaleDateString()}
                        </div>
                    </div>
                    <div class="news-item-category">${news.category}</div>
                    <div class="news-item-content">
                        ${news.content.split('\n').map(paragraph => `<p>${paragraph}</p>`).join('')}
                    </div>
                    ${news.tags && news.tags.length > 0 ? `
                        <div style="margin-bottom: 15px;">
                            <strong>Tags:</strong> ${news.tags.map(tag => `<span style="background: #e9ecef; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 5px;">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="news-item-actions">
                        <button onclick="editNews(${newsData.indexOf(news)})" class="btn btn-secondary btn-small">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button onclick="deleteNews(${newsData.indexOf(news)})" class="btn btn-danger btn-small">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button onclick="viewFullNews(${newsData.indexOf(news)})" class="btn btn-success btn-small">
                            <i class="fas fa-eye"></i> View Full
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderStats() {
            const container = document.getElementById('statsGrid');
            
            // Calculate statistics
            const totalNews = newsData.length;
            const urgentNews = newsData.filter(news => news.isUrgent).length;
            const categoryCounts = {};
            const recentNews = newsData.filter(news => {
                const newsDate = new Date(news.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return newsDate >= weekAgo;
            }).length;

            // Count by category
            newsData.forEach(news => {
                categoryCounts[news.category] = (categoryCounts[news.category] || 0) + 1;
            });

            const mostActiveCategory = Object.keys(categoryCounts).reduce((a, b) => 
                categoryCounts[a] > categoryCounts[b] ? a : b, 'none'
            );

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalNews}</div>
                    <div class="stat-label">Total Articles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${urgentNews}</div>
                    <div class="stat-label">Urgent News</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${recentNews}</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${mostActiveCategory}</div>
                    <div class="stat-label">Most Active Category</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Object.keys(categoryCounts).length}</div>
                    <div class="stat-label">Categories Used</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${newsData.reduce((total, news) => total + (news.tags ? news.tags.length : 0), 0)}</div>
                    <div class="stat-label">Total Tags</div>
                </div>
            `;
        }

        function filterNews() {
            renderNews();
        }

        function searchNews() {
            renderNews();
        }

        function refreshNews() {
            showLoading(true);
            setTimeout(() => {
                loadNewsData();
                showLoading(false);
                showStatus('News refreshed!', 'info');
            }, 1000);
        }

        function editNews(index) {
            currentEditIndex = index;
            const news = newsData[index];

            document.getElementById('editTitle').value = news.title;
            document.getElementById('editContent').value = news.content;
            document.getElementById('editCategory').value = news.category;
            document.getElementById('editTags').value = news.tags ? news.tags.join(', ') : '';
            document.getElementById('editIsUrgent').checked = news.isUrgent;

            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditIndex = -1;
        }

        function deleteNews(index) {
            if (!confirm('Are you sure you want to delete this news article? This action cannot be undone.')) {
                return;
            }

            showLoading(true);
            
            setTimeout(async () => {
                try {
                    // Remove from news data
                    newsData.splice(index, 1);
                    await saveNewsData();
                    renderNews();
                    renderStats();

                    showStatus('‚úÖ News article deleted successfully!', 'success');

                } catch (error) {
                    showStatus('‚ùå Delete failed: ' + error.message, 'error');
                    console.error('Delete error:', error);
                } finally {
                    showLoading(false);
                }
            }, 500);
        }

        function viewFullNews(index) {
            const news = newsData[index];
            
            // Create full-screen news viewer
            const viewer = document.createElement('div');
            viewer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                cursor: pointer;
                overflow-y: auto;
            `;

            viewer.innerHTML = `
                <div style="max-width: 800px; width: 90%; background: white; border-radius: 20px; padding: 40px; margin: 20px; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 15px;">
                        <h2 style="color: #667eea; margin: 0;">${news.title}</h2>
                        <span style="font-size: 2rem; cursor: pointer; color: #aaa;" onclick="document.body.removeChild(this.closest('div').parentElement)">&times;</span>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <span style="background: #667eea; color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.9rem;">${news.category}</span>
                        ${news.isUrgent ? '<span style="background: #dc3545; color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.9rem;">URGENT</span>' : ''}
                        <span style="color: #666; display: flex; align-items: center; gap: 5px;"><i class="fas fa-calendar"></i> ${new Date(news.date).toLocaleDateString()}</span>
                    </div>
                    
                    <div style="line-height: 1.8; color: #333; margin-bottom: 20px;">
                        ${news.content.split('\n').map(paragraph => `<p style="margin-bottom: 15px;">${paragraph}</p>`).join('')}
                    </div>
                    
                    ${news.tags && news.tags.length > 0 ? `
                        <div style="border-top: 1px solid #e0e0e0; padding-top: 15px;">
                            <strong style="color: #667eea;">Tags:</strong>
                            <div style="margin-top: 10px;">
                                ${news.tags.map(tag => `<span style="background: #e9ecef; color: #495057; padding: 5px 12px; border-radius: 15px; font-size: 0.9rem; margin-right: 10px; display: inline-block; margin-bottom: 5px;">${tag}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="document.body.removeChild(this.closest('div').parentElement)" style="background: #667eea; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-size: 1rem; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;

            viewer.onclick = (e) => {
                if (e.target === viewer) {
                    document.body.removeChild(viewer);
                }
            };
            
            document.body.appendChild(viewer);
        }

        function generateNewsHTML() {
            const html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School News</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: #333; 
        }
        .news-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .news-header { 
            text-align: center; 
            color: white; 
            margin-bottom: 40px; 
        }
        .news-header h1 { 
            font-size: 2.5rem; 
            margin-bottom: 10px; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3); 
        }
        .news-grid { 
            display: grid; 
            gap: 20px; 
        }
        .news-item { 
            background: rgba(255,255,255,0.95); 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            transition: transform 0.3s ease; 
            border-left: 5px solid #667eea;
        }
        .news-item:hover { 
            transform: translateY(-5px); 
        }
        .news-item.urgent { 
            border-left-color: #dc3545; 
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,230,230,0.95) 100%); 
        }
        .news-title { 
            font-size: 1.4rem; 
            font-weight: bold; 
            margin-bottom: 15px; 
            color: #333; 
        }
        .news-meta { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 15px; 
            flex-wrap: wrap; 
            align-items: center; 
        }
        .news-category { 
            background: #667eea; 
            color: white; 
            padding: 4px 12px; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            text-transform: uppercase; 
        }
        .news-date { 
            color: #666; 
            font-size: 0.9rem; 
        }
        .urgent-badge { 
            background: #dc3545; 
            color: white; 
            padding: 4px 12px; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            font-weight: bold; 
        }
        .news-content { 
            line-height: 1.6; 
            color: #555; 
            margin-bottom: 15px; 
        }
        .news-content p { 
            margin-bottom: 15px; 
        }
        .news-tags { 
            margin-top: 15px; 
            padding-top: 15px; 
            border-top: 1px solid #e0e0e0; 
        }
        .news-tag { 
            background: #e9ecef; 
            color: #495057; 
            padding: 3px 10px; 
            border-radius: 12px; 
            font-size: 0.8rem; 
            margin-right: 8px; 
            display: inline-block; 
            margin-bottom: 5px; 
        }
    </style>
</head>
<body>
    <div class="news-container">
        <div class="news-header">
            <h1><i class="fas fa-newspaper"></i> School News</h1>
            <p>Stay updated with the latest school announcements and events</p>
        </div>
        <div class="news-grid">
            ${newsData.map(news => `
                <article class="news-item ${news.isUrgent ? 'urgent' : ''}">
                    <h2 class="news-title">${news.title}</h2>
                    <div class="news-meta">
                        <span class="news-category">${news.category}</span>
                        <span class="news-date"><i class="fas fa-calendar"></i> ${new Date(news.date).toLocaleDateString()}</span>
                        ${news.isUrgent ? '<span class="urgent-badge">URGENT</span>' : ''}
                    </div>
                    <div class="news-content">
                        ${news.content.split('\n').map(paragraph => `<p>${paragraph}</p>`).join('')}
                    </div>
                    ${news.tags && news.tags.length > 0 ? `
                        <div class="news-tags">
                            <strong>Tags:</strong>
                            ${news.tags.map(tag => `<span class="news-tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                </article>
            `).join('')}
        </div>
    </div>
</body>
</html>`;

            // Create and download the HTML file
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'school-news.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showStatus('‚úÖ News HTML file generated and downloaded!', 'success');
        }

        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';

            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        // Auto-load token if previously saved
        window.addEventListener('load', function() {
            const savedToken = localStorage.getItem('githubToken');
            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
                // Auto-authenticate if token exists
                setTimeout(() => {
                    authenticateGitHub();
                }, 500);
            }
            
            // Set default date to today
            document.getElementById('newsDate').value = new Date().toISOString().split('T')[0];
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('editModal');
            if (e.target === modal) {
                closeEditModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape key to close modal
            if (e.key === 'Escape') {
                closeEditModal();
            }
            
            // Ctrl+R to refresh news
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshNews();
            }
        });

        console.log('üì∞ School News Manager loaded successfully!');
        console.log('üìù Configuration needed:');
        console.log('   - Update githubConfig object with your repository details');
        console.log('   - Get GitHub Personal Access Token with Contents & Metadata permissions');
        console.log('   - Repository should be public or token should have appropriate access');
    </script>
</body>
</html>